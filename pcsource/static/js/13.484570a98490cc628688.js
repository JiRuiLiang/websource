webpackJsonp([13],{PPHG:function(t,e){},UbyM:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("NYxO"),s=a("ytf2"),r=a("Tnm7"),i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},c={props:{value:{type:Boolean,default:!1},dataInfo:{type:Object,default:function(){}}},data:function(){return{dialogVisible:this.value}},mounted:function(){},watch:{value:function(t){this.dialogVisible=t},dataInfo:{handler:function(t,e){this.checkShowClose()},deep:!0}},computed:i({},Object(n.c)({mateMaskToken:function(t){return t.app.mateMaskToken}})),methods:{toScan:function(){window.open(this.dataInfo.scan.scanUrl+this.dataInfo.txId)},checkShowClose:function(){var t=this;this.$nextTick(function(){var e=document.getElementsByClassName("el-dialog__headerbtn")[0];1===t.dataInfo.type?e.style.display="none":e.style.display="block"})},getTitle:function(){return 2==this.dataInfo.type?this.$t("message.bridge_32"):this.$t("message.bridge_29")},getDesc:function(){return 2==this.dataInfo.type?this.$t("message.bridge_33"):this.dataInfo.scan&&this.dataInfo.scan.name+" "+this.$t("message.bridge_30")},getScanBtn:function(){return 2==this.dataInfo.type?this.$t("message.bridge_31")+this.dataInfo.scan.scan+this.$t("message.bridge_34"):""},handleClose:function(t){this.$emit("input",!1)}}},o={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-dialog",{attrs:{visible:t.dialogVisible,"append-to-body":"",center:"","lock-scroll":"",width:"467px","before-close":t.handleClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("div",{staticClass:"loading-pop-container"},[t.dataInfo&&1===t.dataInfo.type?n("img",{attrs:{src:a("3s4B"),alt:""}}):n("img",{attrs:{src:a("16RD"),alt:""}}),t._v(" "),n("div",{staticClass:"loading-title"},[t._v(t._s(t.getTitle()))]),t._v(" "),n("div",{staticClass:"loading-desc"},[t._v(t._s(t.getDesc()))]),t._v(" "),n("div",{staticClass:"loading-btn",on:{click:t.toScan}},[t._v(t._s(t.getScanBtn()))])])])],1)},staticRenderFns:[]};function d(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){return function n(s,r){try{var i=e[s](r),c=i.value}catch(t){return void a(t)}if(!i.done)return Promise.resolve(c).then(function(t){n("next",t)},function(t){n("throw",t)});t(c)}("next")})}}var u={components:{LoadingPop:a("VU/8")(c,o,!1,function(t){a("p/PT")},"data-v-466ac2f6",null).exports},data:function(){return{price:"",balance:0,list:[],toChain:{},showPop:!1,constractChainObj:{},curConstractChain:{},receive:0,charge:0,BridgeABI:"",chainInfoData:{},showLoading:!1,loadingData:{type:0}}},watch:{price:function(t){t&&(t=(t+"").match(/^\d*(\.?\d{0,4})/g)[0]||null,this.price=t,parseFloat(this.price)>parseFloat(this.balance)&&(this.price=this.balance),this.receive=(this.price-this.charge).toFixed(4),this.receive<0&&(this.receive=0))},mateMaskToken:function(){this.initConfig()}},computed:(Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t})({},Object(n.c)({mateMaskToken:function(t){return t.app.mateMaskToken},chainObj:function(t){return t.app.chainObj}}),{curChain:function(){return"undefined"!=typeof web3&&this.chainObj&&this.chainObj[web3.currentProvider.chainId]?this.chainObj[web3.currentProvider.chainId]:{}},getShowList:function(){var t=[];if("undefined"!=typeof web3&&this.list.length){var e=!0,a=!1,n=void 0;try{for(var s,r=this.list[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){var i="0x"+s.value.chainId.toString(16);i!==this.curChain.chainId&&t.push(this.chainObj[i])}}catch(t){a=!0,n=t}finally{try{!e&&r.return&&r.return()}finally{if(a)throw n}}}return t}}),mounted:function(){Object(s.b)(),this.initConfig()},methods:{toSwitch:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var a,n,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=window.ethereum){e.next=3;break}return e.abrupt("return");case 3:if(n=t.toChain.chainId,s=t.chainInfoData[n]){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,a.request({method:"wallet_addEthereumChain",params:s}).catch();case 9:e.sent;case 10:case"end":return e.stop()}},e,t)}))()},initConfig:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var a,n,s,r,i,c,o,d,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.GetAddChainData();case 2:return e.next=4,t.GetChainConfigData();case 4:return e.next=6,t.$api.getConfList({});case 6:for(a=e.sent,t.list=a,n=!0,s=!1,r=void 0,e.prev=11,i=t.list[Symbol.iterator]();!(n=(c=i.next()).done);n=!0)o=c.value,t.constractChainObj["0x"+o.chainId.toString(16)]=o;e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),s=!0,r=e.t0;case 19:e.prev=19,e.prev=20,!n&&i.return&&i.return();case 22:if(e.prev=22,!s){e.next=25;break}throw r;case 25:return e.finish(22);case 26:return e.finish(19);case 27:if(t.constractChainObj[web3.currentProvider.chainId]){e.next=30;break}return t.$message.error(t.$t("message.bridge_35")),e.abrupt("return");case 30:return e.next=32,t.$api.GetSystemConfig({sAppId:"Erax-dev",sKey1:"bridge"});case 32:d=e.sent,u=d.vList,t.BridgeABI=u[0].sValue,t.curConstractChain=t.constractChainObj[web3.currentProvider.chainId],t.updateBalance(),t.$nextTick(function(){if(t.getShowList.length){t.$set(t,"toChain",t.getShowList[0]),t.toChain=t.getShowList[0];var e=t.constractChainObj[t.toChain.chainId];t.charge=parseFloat(parseFloat(e.fee).toFixed(4))}});case 38:case"end":return e.stop()}},e,t,[[11,15,19,27],[20,,22,26]])}))()},updateBalance:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var a,n,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.mateMaskToken){e.next=11;break}return(a=t.curConstractChain.neraAddress)||(a=t.curConstractChain.address),n=new web3.eth.Contract(JSON.parse(r.s),a),e.next=6,n.methods.balanceOf(t.mateMaskToken).call().catch(function(t){if(t)return s=0,!1});case 6:return s=e.sent,e.next=9,n.methods.decimals().call();case 9:i=e.sent,t.balance=t.$util.fromWei(s,i,4);case 11:case"end":return e.stop()}},e,t)}))()},GetChainConfigData:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var a,n,s,r,i,c,o,d,u,l,h,v,p,f,g,m,_,C,b,w;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$api.GetConfigData({});case 2:for(a=e.sent,n=a.vConfig,s={},r=!0,i=!1,c=void 0,e.prev=8,o=n[Symbol.iterator]();!(r=(d=o.next()).done);r=!0)u=d.value,s[u.sKey]=u.sValue;e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),i=!0,c=e.t0;case 16:e.prev=16,e.prev=17,!r&&o.return&&o.return();case 19:if(e.prev=19,!i){e.next=22;break}throw c;case 22:return e.finish(19);case 23:return e.finish(16);case 24:for(l={},h=s.chainInfo,v=h.split("|"),p=!0,f=!1,g=void 0,e.prev=30,m=v[Symbol.iterator]();!(p=(_=m.next()).done);p=!0)C=_.value,(b=C.split(",")).length&&((w={}).chainId=b[0],w.name=b[1],w.icon=b[2],w.scan=b[3],w.scanUrl=b[4],l[b[0]]=w);e.next=38;break;case 34:e.prev=34,e.t1=e.catch(30),f=!0,g=e.t1;case 38:e.prev=38,e.prev=39,!p&&m.return&&m.return();case 41:if(e.prev=41,!f){e.next=44;break}throw g;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return t.$store.dispatch("app/changeData",{key:"chainObj",val:l}),e.abrupt("return",!0);case 48:case"end":return e.stop()}},e,t,[[8,12,16,24],[17,,19,23],[30,34,38,46],[39,,41,45]])}))()},GetAddChainData:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var a,n,s,r,i,c,o,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$api.GetSystemConfig({sAppId:"Erax-dev",sKey1:"ChainData"});case 2:for(a=e.sent,n=a.vList,t.chainInfoData={},s=!0,r=!1,i=void 0,e.prev=8,c=n[Symbol.iterator]();!(s=(o=c.next()).done);s=!0)d=o.value,t.chainInfoData[d.sKey2]=JSON.parse(d.sValue);e.next=16;break;case 12:e.prev=12,e.t0=e.catch(8),r=!0,i=e.t0;case 16:e.prev=16,e.prev=17,!s&&c.return&&c.return();case 19:if(e.prev=19,!r){e.next=22;break}throw i;case 22:return e.finish(19);case 23:return e.finish(16);case 24:case"end":return e.stop()}},e,t,[[8,12,16,24],[17,,19,23]])}))()},selectChain:function(t){this.toChain=t,this.showPop=!1},transfer:function(){var t=this;return d(regeneratorRuntime.mark(function e(){var a,n,s,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.loadingData.type=1,t.loadingData.scan=t.chainObj["0x"+t.curConstractChain.chainId.toString(16)],t.showLoading=!0,a=t.curConstractChain.neraAddress||t.curConstractChain.address,n=new web3.eth.Contract(JSON.parse(r.s),a),e.next=7,web3.eth.getGasPrice();case 7:if(s=e.sent,console.log("推荐gas费==="+s),"ETH"!=t.curConstractChain.code){e.next=27;break}return e.next=12,n.methods.allowance(t.mateMaskToken,t.curConstractChain.address).call();case 12:if("0"!=(i=e.sent)){e.next=20;break}return console.log("跳转ERC20授权!"),e.next=17,n.methods.approve(t.curConstractChain.address,"1000000000000000000000000000000000000000000").send({from:t.mateMaskToken,gasPrice:s},function(e,a){if(e)return t.showLoading=!1,console.log("授权报错"),Vue.prototype.$message.error(i18n.t("message.assets_lang_90")),t.showLoading=!1,!1});case 17:return e.next=19,n.methods.allowance(t.mateMaskToken,t.curConstractChain.address).call();case 19:i=e.sent;case 20:if("0"!=i){e.next=26;break}return console.log("ERC20未授权!"),t.showLoading=!1,e.abrupt("return",!1);case 26:console.log("ERC20已授权!");case 27:return c=new web3.eth.Contract(JSON.parse(t.BridgeABI),t.curConstractChain.address),e.next=30,c.methods.swapIn(web3.utils.toWei(t.price),t.toChain.chainId).send({from:t.mateMaskToken,gasPrice:s},function(e,a){if(e)return t.showLoading=!1,!1;t.loadingData.type=2,t.loadingData.txId=a,t.showStake=!1,t.$api.swapIn({txId:a,userAddress:t.mateMaskToken,amount:t.price,chainId:parseInt(t.toChain.chainId,16),fromChainId:t.curConstractChain.chainId})});case 30:t.showLoading=!1,t.price="",t.receive=0,t.updateBalance();case 34:case"end":return e.stop()}},e,t)}))()},getChainName:function(){return this.toChain.chainId&&this.chainObj?this.chainObj[this.toChain.chainId].name:""}}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"nera-bridge"},[n("div",{staticClass:"bridge-container"},[n("div",{staticClass:"title"},[t._v(t._s(t.$t("message.bridge_1")))]),t._v(" "),n("div",{staticClass:"flex-sb"},[n("div",{staticClass:"coin-div"},[n("span",{staticClass:"txt1"},[t._v(t._s(t.$t("message.bridge_2")))]),n("img",{attrs:{src:a("jzCB"),alt:""}}),n("span",{staticClass:"txt2"},[t._v("NERA")])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.mateMaskToken,expression:"mateMaskToken"}],staticClass:"txt3",on:{click:function(e){return t.$router.push("/bridge-history")}}},[t._v("\n        "+t._s(t.$t("message.bridge_14"))+"\n      ")])]),t._v(" "),n("div",{staticClass:"nera-bridge-swap"},[n("div",{staticClass:"select-item"},[n("img",{attrs:{src:t.curChain.icon,alt:""}}),t._v(" "),n("span",[t._v(t._s(t.curChain.name))])]),t._v(" "),t._m(0),t._v(" "),n("el-popover",{attrs:{placement:"bottom-end",title:t.$t("message.bridge_28"),width:"328",trigger:"click","popper-class":"option-pop","visible-arrow":!1},model:{value:t.showPop,callback:function(e){t.showPop=e},expression:"showPop"}},[t._l(t.getShowList,function(e,a){return n("div",{key:a,staticClass:"chain-option",class:t.toChain.chainId===e.chainId?"select-option":"",on:{click:function(a){return t.selectChain(e)}}},[n("img",{attrs:{src:e.icon,alt:""}}),t._v(" "),n("span",[t._v(t._s(e.name))]),t._v(" "),n("i",{directives:[{name:"show",rawName:"v-show",value:t.toChain.chainId===e.chainId,expression:"toChain.chainId === item.chainId"}],staticClass:"iconfont icon-gou"})])}),t._v(" "),n("div",{staticClass:"select-item",attrs:{slot:"reference"},slot:"reference"},[n("img",{attrs:{src:t.toChain.icon,alt:""}}),t._v(" "),n("span",[t._v(t._s(t.toChain.name))]),t._v(" "),n("i",{staticClass:"fas fa-chevron-right"})])],2)],1),t._v(" "),n("div",{staticClass:"notice"},[n("div",[t._v("\n        "+t._s(t.$t("message.bridge_26"))+" "+t._s(t.getChainName())+" "+t._s(t.$t("message.bridge_3"))+"\n      ")]),t._v(" "),n("div",[t._v("\n        "+t._s(t.$t("message.bridge_4"))+"\n        "),n("div",{staticClass:"bridge-btn add",on:{click:t.toSwitch}},[t._v(t._s(t.$t("message.bridge_27")))]),t._v("\n        "+t._s(t.$t("message.bridge_5"))+"\n      ")])]),t._v(" "),n("div",{staticClass:"nera-balance"},[n("span",{staticClass:"balance-title"},[t._v(t._s(t.$t("message.bridge_6"))+": ")]),n("span",{staticClass:"balance"},[t._v(t._s(t._f("filterThousands")(t.balance)))])]),t._v(" "),n("div",[n("div",{staticClass:"amount"},[t._v(t._s(t.$t("message.bridge_7")))]),t._v(" "),n("el-input",{staticClass:"input-with-select",attrs:{type:"number"},model:{value:t.price,callback:function(e){t.price=e},expression:"price"}})],1),t._v(" "),n("el-row",[n("el-col",{staticClass:"cost-item",attrs:{span:12}},[n("span",{staticClass:"cost1"},[t._v(t._s(t.$t("message.bridge_8"))+" ≈ ")]),t._v(" "),n("span",{staticClass:"txt2"},[t._v(t._s(t.receive))]),n("img",{attrs:{src:a("jzCB"),alt:""}}),n("span",{staticClass:"txt2"},[t._v("NERA")])]),t._v(" "),n("el-col",{staticClass:"cost-item",attrs:{span:12}},[n("span",{staticClass:"cost2"},[t._v("Gas ≈ ")]),t._v(" "),n("span",{staticClass:"txt2"},[t._v(t._s(t.charge))]),n("img",{attrs:{src:a("jzCB"),alt:""}}),n("span",{staticClass:"txt2"},[t._v("NERA")])])],1),t._v(" "),n("div",{staticClass:"address"},[n("span",{staticClass:"address-txt1"},[t._v(t._s(t.$t("message.bridge_9"))+": ")]),n("span",{staticClass:"address-txt2"},[t._v(t._s(t.mateMaskToken))])]),t._v(" "),t.mateMaskToken?n("el-button",{staticClass:"transfer",attrs:{disabled:t.price<=0||t.receive<5||!t.curConstractChain.chainId},on:{click:t.transfer}},[t._v("\n      "+t._s(t.$t("message.bridge_16"))+"\n    ")]):n("div",{staticClass:"bridge-btn btn-connect",on:{click:function(e){return t.$router.push("/metamask")}}},[t._v("\n      "+t._s(t.$t("message.bridge_15"))+"\n    ")]),t._v(" "),n("div",{staticClass:"tips"},[n("div",{staticClass:"tips-title desc"},[t._v(t._s(t.$t("message.bridge_10")))]),t._v(" "),n("div",{staticClass:"desc"},[t._v("1. "+t._s(t.$t("message.bridge_11"))+" "+t._s(parseFloat((t.charge+5).toFixed(4)))+" NERA.")]),t._v(" "),n("div",{staticClass:"desc"},[t._v("2. "+t._s(t.$t("message.bridge_12"))+" "+t._s(t.balance)+" NERA.")]),t._v(" "),n("div",{staticClass:"desc"},[t._v("\n        3. "+t._s(t.$t("message.bridge_13"))+"\n      ")])])],1),t._v(" "),n("loading-pop",{attrs:{dataInfo:t.loadingData},model:{value:t.showLoading,callback:function(e){t.showLoading=e},expression:"showLoading"}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"exchange"},[e("i",{staticClass:"iconfont icon-shuangjiantou"})])}]};var h=a("VU/8")(u,l,!1,function(t){a("wMYb"),a("PPHG")},"data-v-e127ac6a",null);e.default=h.exports},"p/PT":function(t,e){},wMYb:function(t,e){}});