webpackJsonp([17],{Iq6w:function(e,t){},UbyM:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("NYxO"),r=n("ytf2"),s=n("Tnm7");function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function a(r,s){try{var i=t[r](s),c=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(c).then(function(e){a("next",e)},function(e){a("throw",e)});e(c)}("next")})}}var c={data:function(){return{price:"",balance:0,list:[],toChain:{},showPop:!1,constractChainObj:{},curConstractChain:{},receive:0,charge:0,BridgeABI:"",chainInfoData:{}}},watch:{price:function(e){e&&(e=(e+"").match(/^\d*(\.?\d{0,4})/g)[0]||null,this.price=e,parseFloat(this.price)>parseFloat(this.balance)&&(this.price=this.balance),this.receive=(this.price-this.charge).toFixed(4),this.receive<0&&(this.receive=0))},mateMaskToken:function(){this.initConfig()}},computed:(Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e})({},Object(a.c)({mateMaskToken:function(e){return e.app.mateMaskToken},chainObj:function(e){return e.app.chainObj}}),{curChain:function(){return"undefined"!=typeof web3&&this.chainObj&&this.chainObj[web3.currentProvider.chainId]?this.chainObj[web3.currentProvider.chainId]:{}},getShowList:function(){var e=[];if("undefined"!=typeof web3&&this.list.length){var t=!0,n=!1,a=void 0;try{for(var r,s=this.list[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var i="0x"+r.value.chainId.toString(16);i!==this.curChain.chainId&&e.push(this.chainObj[i])}}catch(e){n=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw a}}}return e}}),mounted:function(){Object(r.b)(),this.initConfig()},methods:{toSwitch:function(){var e=this;return i(regeneratorRuntime.mark(function t(){var n,a,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=window.ethereum){t.next=3;break}return t.abrupt("return");case 3:if(a=e.toChain.chainId,r=e.chainInfoData[a]){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,n.request({method:"wallet_addEthereumChain",params:r}).catch();case 9:t.sent;case 10:case"end":return t.stop()}},t,e)}))()},initConfig:function(){var e=this;return i(regeneratorRuntime.mark(function t(){var n,a,r,s,i,c,o,u,h;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.GetAddChainData();case 2:return t.next=4,e.GetChainConfigData();case 4:return t.next=6,e.$api.getConfList({});case 6:for(n=t.sent,e.list=n,a=!0,r=!1,s=void 0,t.prev=11,i=e.list[Symbol.iterator]();!(a=(c=i.next()).done);a=!0)o=c.value,e.constractChainObj["0x"+o.chainId.toString(16)]=o;t.next=19;break;case 15:t.prev=15,t.t0=t.catch(11),r=!0,s=t.t0;case 19:t.prev=19,t.prev=20,!a&&i.return&&i.return();case 22:if(t.prev=22,!r){t.next=25;break}throw s;case 25:return t.finish(22);case 26:return t.finish(19);case 27:if(e.constractChainObj[web3.currentProvider.chainId]){t.next=30;break}return e.$message.error("当前链不支持"),t.abrupt("return");case 30:return t.next=32,e.$api.GetSystemConfig({sAppId:"Erax-dev",sKey1:"bridge"});case 32:u=t.sent,h=u.vList,e.BridgeABI=h[0].sValue,e.curConstractChain=e.constractChainObj[web3.currentProvider.chainId],e.charge=parseFloat(parseFloat(e.curConstractChain.fee).toFixed(4)),e.updateBalance(),e.$nextTick(function(){e.getShowList.length&&e.$set(e,"toChain",e.getShowList[0])});case 39:case"end":return t.stop()}},t,e,[[11,15,19,27],[20,,22,26]])}))()},updateBalance:function(){var e=this;return i(regeneratorRuntime.mark(function t(){var n,a,r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.mateMaskToken){t.next=11;break}return(n=e.curConstractChain.neraAddress)||(n=e.curConstractChain.address),a=new web3.eth.Contract(JSON.parse(s.s),n),t.next=6,a.methods.balanceOf(e.mateMaskToken).call().catch(function(e){if(e)return r=0,!1});case 6:return r=t.sent,t.next=9,a.methods.decimals().call();case 9:i=t.sent,e.balance=e.$util.fromWei(r,i,4);case 11:case"end":return t.stop()}},t,e)}))()},GetChainConfigData:function(){var e=this;return i(regeneratorRuntime.mark(function t(){var n,a,r,s,i,c,o,u,h,l,v,d,p,f,C,m,b,g,_,w;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.GetConfigData({});case 2:for(n=t.sent,a=n.vConfig,r={},s=!0,i=!1,c=void 0,t.prev=8,o=a[Symbol.iterator]();!(s=(u=o.next()).done);s=!0)h=u.value,r[h.sKey]=h.sValue;t.next=16;break;case 12:t.prev=12,t.t0=t.catch(8),i=!0,c=t.t0;case 16:t.prev=16,t.prev=17,!s&&o.return&&o.return();case 19:if(t.prev=19,!i){t.next=22;break}throw c;case 22:return t.finish(19);case 23:return t.finish(16);case 24:for(l={},v=r.chainInfo,d=v.split("|"),p=!0,f=!1,C=void 0,t.prev=30,m=d[Symbol.iterator]();!(p=(b=m.next()).done);p=!0)g=b.value,(_=g.split(",")).length&&((w={}).chainId=_[0],w.name=_[1],w.icon=_[2],l[_[0]]=w);t.next=38;break;case 34:t.prev=34,t.t1=t.catch(30),f=!0,C=t.t1;case 38:t.prev=38,t.prev=39,!p&&m.return&&m.return();case 41:if(t.prev=41,!f){t.next=44;break}throw C;case 44:return t.finish(41);case 45:return t.finish(38);case 46:return e.$store.dispatch("app/changeData",{key:"chainObj",val:l}),t.abrupt("return",!0);case 48:case"end":return t.stop()}},t,e,[[8,12,16,24],[17,,19,23],[30,34,38,46],[39,,41,45]])}))()},GetAddChainData:function(){var e=this;return i(regeneratorRuntime.mark(function t(){var n,a,r,s,i,c,o,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.GetSystemConfig({sAppId:"Erax-dev",sKey1:"ChainData"});case 2:for(n=t.sent,a=n.vList,e.chainInfoData={},r=!0,s=!1,i=void 0,t.prev=8,c=a[Symbol.iterator]();!(r=(o=c.next()).done);r=!0)u=o.value,e.chainInfoData[u.sKey2]=JSON.parse(u.sValue);t.next=16;break;case 12:t.prev=12,t.t0=t.catch(8),s=!0,i=t.t0;case 16:t.prev=16,t.prev=17,!r&&c.return&&c.return();case 19:if(t.prev=19,!s){t.next=22;break}throw i;case 22:return t.finish(19);case 23:return t.finish(16);case 24:case"end":return t.stop()}},t,e,[[8,12,16,24],[17,,19,23]])}))()},selectChain:function(e){this.toChain=e,this.showPop=!1},transfer:function(){var e=this;return i(regeneratorRuntime.mark(function t(){var n,a,r,i,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.$event.$emit("SHOW-LOADING",!0),n=e.curConstractChain.neraAddress||e.curConstractChain.address,a=new web3.eth.Contract(JSON.parse(s.s),n),t.next=5,web3.eth.getGasPrice();case 5:if(r=t.sent,console.log("推荐gas费==="+r),"ETH"!=e.curConstractChain.code){t.next=25;break}return t.next=10,a.methods.allowance(e.mateMaskToken,e.curConstractChain.address).call();case 10:if("0"!=(i=t.sent)){t.next=18;break}return console.log("跳转ERC20授权!"),t.next=15,a.methods.approve(e.curConstractChain.address,"1000000000000000000000000000000000000000000").send({from:e.mateMaskToken,gasPrice:r},function(t,n){if(t)return Vue.prototype.$event.$emit("SHOW-LOADING",!1),console.log("授权报错"),Vue.prototype.$message.error(i18n.t("message.assets_lang_90")),e.$event.$emit("SHOW-LOADING",!1),!1});case 15:return t.next=17,a.methods.allowance(e.mateMaskToken,e.curConstractChain.address).call();case 17:i=t.sent;case 18:if("0"!=i){t.next=24;break}return console.log("ERC20未授权!"),e.$event.$emit("SHOW-LOADING",!1),t.abrupt("return",!1);case 24:console.log("ERC20已授权!");case 25:return c=new web3.eth.Contract(JSON.parse(e.BridgeABI),e.curConstractChain.address),t.next=28,c.methods.swapIn(web3.utils.toWei(e.price),e.toChain.chainId).send({from:e.mateMaskToken,gasPrice:r},function(t,n){if(t)return e.$event.$emit("SHOW-LOADING",!1),!1;e.showStake=!1,e.$api.swapIn({txId:n,userAddress:e.mateMaskToken,amount:e.price,chainId:parseInt(e.toChain.chainId,16),fromChainId:e.curConstractChain.chainId})});case 28:e.$event.$emit("SHOW-LOADING",!1),e.price="",e.receive=0,e.updateBalance();case 32:case"end":return t.stop()}},t,e)}))()},getChainName:function(){return this.toChain.chainId&&this.chainObj?this.chainObj[this.toChain.chainId].name:""}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"nera-bridge"},[a("div",{staticClass:"bridge-container"},[a("div",{staticClass:"title"},[e._v("NERA Bridge")]),e._v(" "),a("div",{staticClass:"flex-sb"},[e._m(0),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.mateMaskToken&&!1,expression:"mateMaskToken && false"}],staticClass:"txt3",on:{click:function(t){return e.$router.push("/bridge-history")}}},[e._v("\n        History\n      ")])]),e._v(" "),a("div",{staticClass:"nera-bridge-swap"},[a("div",{staticClass:"select-item"},[a("img",{attrs:{src:e.curChain.icon,alt:""}}),e._v(" "),a("span",[e._v(e._s(e.curChain.name))])]),e._v(" "),e._m(1),e._v(" "),a("el-popover",{attrs:{placement:"bottom-end",title:"Select Network",width:"328",trigger:"click","popper-class":"option-pop","visible-arrow":!1},model:{value:e.showPop,callback:function(t){e.showPop=t},expression:"showPop"}},[e._l(e.getShowList,function(t,n){return a("div",{key:n,staticClass:"chain-option",class:e.toChain.chainId===t.chainId?"select-option":"",on:{click:function(n){return e.selectChain(t)}}},[a("img",{attrs:{src:t.icon,alt:""}}),e._v(" "),a("span",[e._v(e._s(t.name))]),e._v(" "),a("i",{directives:[{name:"show",rawName:"v-show",value:e.toChain.chainId===t.chainId,expression:"toChain.chainId === item.chainId"}],staticClass:"iconfont icon-gou"})])}),e._v(" "),a("div",{staticClass:"select-item",attrs:{slot:"reference"},slot:"reference"},[a("img",{attrs:{src:e.toChain.icon,alt:""}}),e._v(" "),a("span",[e._v(e._s(e.toChain.name))]),e._v(" "),a("i",{staticClass:"fas fa-chevron-right"})])],2)],1),e._v(" "),a("div",{staticClass:"notice"},[a("div",[e._v("\n        If you have not add "+e._s(e.getChainName())+" in your MetaMask yet,\n      ")]),e._v(" "),a("div",[e._v("\n        please click\n        "),a("div",{staticClass:"bridge-btn add",on:{click:e.toSwitch}},[e._v("Add network")]),e._v("\n        and continue.\n      ")])]),e._v(" "),a("div",{staticClass:"nera-balance"},[a("span",[e._v("NERA Balance: ")]),a("span",{staticClass:"balance"},[e._v(e._s(e._f("filterThousands")(e.balance)))])]),e._v(" "),a("div",[a("div",{staticClass:"amount"},[e._v("Amount")]),e._v(" "),a("el-input",{staticClass:"input-with-select",attrs:{type:"number"},model:{value:e.price,callback:function(t){e.price=t},expression:"price"}})],1),e._v(" "),a("el-row",[a("el-col",{staticClass:"cost-item",attrs:{span:12}},[a("span",{staticClass:"cost1"},[e._v("You will receive ≈ ")]),e._v(" "),a("span",{staticClass:"txt2"},[e._v(e._s(e.receive))]),a("img",{attrs:{src:n("jzCB"),alt:""}}),a("span",{staticClass:"txt2"},[e._v("NERA")])]),e._v(" "),a("el-col",{staticClass:"cost-item",attrs:{span:12}},[a("span",{staticClass:"cost2"},[e._v("Service charge ≈ ")]),e._v(" "),a("span",{staticClass:"txt2"},[e._v(e._s(e.charge))]),a("img",{attrs:{src:n("jzCB"),alt:""}}),a("span",{staticClass:"txt2"},[e._v("NERA")])])],1),e._v(" "),a("div",{staticClass:"address"},[a("span",{staticClass:"address-txt1"},[e._v("Destination Address: ")]),a("span",{staticClass:"address-txt2"},[e._v(e._s(e.mateMaskToken))])]),e._v(" "),e.mateMaskToken?a("el-button",{staticClass:"transfer",attrs:{disabled:e.price<=0||e.receive<5||!e.curConstractChain.chainId},on:{click:e.transfer}},[e._v("\n      Transfer\n    ")]):a("div",{staticClass:"bridge-btn btn-connect",on:{click:function(t){return e.$router.push("/metamask")}}},[e._v("\n      Connect Wallet\n    ")]),e._v(" "),a("div",{staticClass:"tips"},[a("div",{staticClass:"tips-title desc"},[e._v("Reminder")]),e._v(" "),a("div",{staticClass:"desc"},[e._v("1. Mininum amount is "+e._s(parseFloat((e.charge+5).toFixed(4)))+" NERA.")]),e._v(" "),a("div",{staticClass:"desc"},[e._v("2. Maximum amount is "+e._s(e.balance)+" NERA.")]),e._v(" "),a("div",{staticClass:"desc"},[e._v("\n        3. Network fees and the final price depend on market conditions.The\n        final rate may be different once the transaction is completed.\n      ")])])],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"coin-div"},[t("span",{staticClass:"txt1"},[this._v("Asset")]),t("img",{attrs:{src:n("jzCB"),alt:""}}),t("span",{staticClass:"txt2"},[this._v("NERA")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"exchange"},[t("i",{staticClass:"iconfont icon-shuangjiantou"})])}]};var u=n("VU/8")(c,o,!1,function(e){n("Iq6w"),n("uezl")},"data-v-18da6c66",null);t.default=u.exports},uezl:function(e,t){}});